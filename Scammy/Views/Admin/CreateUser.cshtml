@{
    ViewData["Title"] = "Create User";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section id="create-user">
    <div class="container">
        <div class="dashboard-box">
            <div class="row">

                <!-- Left Column: Image & Titles -->
                <div class="col-left">
                    <img src="~/assets/images/admin/userprofile.png" alt="User Profile Icon" class="create-user-img">
                    <h2 class="dashboard-title">Create New User</h2>
                    <p class="dashboard-subtitle">Fill in the details below to add a new user to the system.</p>
                </div>

                <!-- Right Column: Form -->
                <div class="col-right">
                    <form id="createUserForm" asp-action="CreateUser" asp-controller="Admin" method="post" class="user-form">
                        <div class="form-group">
                            <label for="fullname">Full Name</label>
                            <input type="text" id="fullname" name="fullName" placeholder="Enter full name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" placeholder="Enter email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" name="password" placeholder="Enter password" required>
                        </div>
                        <div class="form-group">
                            <label for="role">User Role</label>
                            <select id="role" name="role" required>
                                <option value="">Select role</option>
                                <option value="admin">Admin</option>
                                <option value="analyst">Analyst</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="main-button">Create User</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
</section>

@section Styles {
    <link rel="stylesheet" href="~/assets/css/CreateUser.css" />
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function () {
            $('#createUserForm').submit(function (e) {
                e.preventDefault();

                // Show SweetAlert2 loading popup
                Swal.fire({
                    title: 'Processing...',
                    html: 'Creating user, please wait.',
                    didOpen: () => {
                        Swal.showLoading()
                    },
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    allowEnterKey: false,
                    showConfirmButton: false
                });

                $.ajax({
                    url: $(this).attr('action'),
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        Swal.close(); // Close loading popup
                        if (response.isSuccess) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: response.message,
                                confirmButtonColor: '#33ccc5'
                            });
                            $('#createUserForm')[0].reset();
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: response.message,
                                confirmButtonColor: '#ef4444'
                            });
                        }
                    },
                    error: function (xhr) {
                        Swal.close(); // Close loading popup
                        var errorMsg = xhr.responseText || "Error creating user!";
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: errorMsg,
                            confirmButtonColor: '#ef4444'
                        });
                    }
                });
            });

            // Header scroll/reset logic
            let lastScrollTop = 0;
            let headerFixed = false;

            function resetHeader() {
                $('.header-area, .background-header').removeAttr('style');
                $('.header-area .main-nav').removeAttr('style');
                $('.header-area .main-nav .nav').removeAttr('style');
                $('.header-area .main-nav .nav li').removeAttr('style');
                $('.dropdown-menu, .submenu ul, .dropdown, .submenu').removeAttr('style');
            }

            $(window).scroll(function() {
                let scrollTop = $(this).scrollTop();
                if (scrollTop < 200 && !headerFixed) resetHeader();
                lastScrollTop = scrollTop;
            });

            resetHeader();
            $(document).on('click', function() {
                if (!headerFixed) setTimeout(resetHeader, 100);
            });

            setInterval(function() {
                if ($(window).scrollTop() < 200) resetHeader();
            }, 5000);
        });
    </script>
}
