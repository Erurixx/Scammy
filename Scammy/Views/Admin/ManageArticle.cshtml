@model IEnumerable<Scammy.Models.Article>

@{
    ViewBag.Title = "ManageArticle";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var articles = Model?.Where(a => a.Status != "draft").OrderByDescending(a => a.CreatedAt)
                   ?? Enumerable.Empty<Scammy.Models.Article>();
}

@section Styles {
    <link rel="stylesheet" href="~/assets/css/ManageArticle.css" />
}

<!-- Main Navigation -->
<div class="az-dashboard-nav" style="margin-top: 8rem; margin-bottom: -7rem;">
    <nav class="nav">
        @{
            var ManageArticle = ViewBag.ActivePage == "ManageArticle" ? "active" : "";
        }
        <a class="nav-link @ManageArticle" href="@Url.Action("ManageArticle", "Admin")">Manage Articles</a>
        <a class="nav-link" href="@Url.Action("ManageReport", "Admin")">Manage Reports</a>
    </nav>
</div>

<!-- Stats -->
<div class="stats-container" style="margin-top:130px; margin-bottom:30px;">
    <div class="stat-card">
        <div class="stat-icon pending">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="6" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12" y2="16"></line>
            </svg>
        </div>
        <div class="stat-content">
            <div class="stat-number">@articles.Count(a => a.Status == "pending")</div>
            <div class="stat-label">Pending Articles</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon published">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        </div>
        <div class="stat-content">
            <div class="stat-number">@articles.Count(a => a.Status == "published")</div>
            <div class="stat-label">Published Articles</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon declined">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </div>
        <div class="stat-content">
            <div class="stat-number">@articles.Count(a => a.Status == "declined")</div>
            <div class="stat-label">Declined Articles</div>
        </div>
    </div>
</div>

<div class="header-actions">
    <div class="search-filter-container">
        <div class="search-box">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" id="searchInput" placeholder="Search article by Title, Author..." class="search-input">
        </div>
        <select id="categoryFilter" class="filter-select">
            <option value="">All Categories</option>
            <option value="Phone Scams">Phone Scams</option>
            <option value="Email Scams">Email Scams</option>
            <option value="Social Media Scams">Social Media Scams</option>
            <option value="Investment Scams">Investment Scams</option>
            <option value="Romance Scams">Romance Scams</option>
            <option value="Tech Support Scams">Tech Support Scams</option>
            <option value="Shopping Scams">Shopping Scams</option>
            <option value="Cryptocurrency Scams">Cryptocurrency Scams</option>
            <option value="Identity Theft">Identity Theft</option>
            <option value="General Awareness">General Awareness</option>
            <option value="Others">Others</option>
        </select>

        <select id="statusFilter" class="filter-select">
            <option value="">All Status</option>
            <option value="pending">Pending</option>
            <option value="published">Published</option>
            <option value="declined">Declined</option>
        </select>

        <!-- Reset Button with Circular Arrow -->
        <button id="resetFilters" class="reset-btn" title="Reset">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        </button>


    </div>
</div>



<!-- Articles Table -->
<table class="table table-hover modern-table mt-3">
    <thead>
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Category</th>
            <th>Status</th>
            <th>Created Date</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var article in articles)
        {
            <tr class="article-card"
                data-title="@article.Title.ToLower()"
                data-excerpt="@article.Excerpt.ToLower()"
                data-category="@article.Category"
                data-status="@article.Status.ToLower()">
                <td>@article.Title</td>
                <td>@article.Author</td>
                <td>@article.Category</td>
                <td><span class="status-badge @(article.Status.ToLower())">@article.Status</span></td>
                <td>@article.CreatedAt.ToString("yyyy-MM-dd")</td>
                <td>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewModal-@article.Id">View</button>
                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#publishModal-@article.Id">Publish</button>
                        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#declineModal-@article.Id">Decline</button>
                    </div>
                </td>
            </tr>
        }
    </tbody>


</table>

<!-- Modals -->
@foreach (var article in articles)
{
    <!-- View Modal -->
    <div class="modal fade" id="viewModal-@article.Id" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">@article.Title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Author:</strong> @article.Author</p>
                    <p><strong>Category:</strong> @article.Category</p>
                    <p>@article.Content</p>
                    <p><strong>Excerpt:</strong> @article.Excerpt</p>
                    <p><strong>Tags:</strong> @article.Tags</p>
                    <p><strong>Created At:</strong> @article.CreatedAt.ToString("yyyy-MM-dd")</p>
                    @if (!string.IsNullOrEmpty(article.AdminComment))
                    {
                        <p><strong>Admin Comment:</strong> @article.AdminComment</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Publish Modal -->
    <div class="modal fade" id="publishModal-@article.Id" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form asp-action="UpdateStatus" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title">Publish Article</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="id" value="@article.Id" />
                        <input type="hidden" name="action" value="approve" />
                        <div class="mb-3">
                            <label for="AdminComment" class="form-label">Admin Comment *</label>
                            <textarea name="AdminComment" class="form-control" required>@article.AdminComment</textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Publish</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Decline Modal -->
    <div class="modal fade" id="declineModal-@article.Id" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form asp-action="UpdateStatus" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title">Decline Article</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="id" value="@article.Id" />
                        <input type="hidden" name="action" value="decline" />
                        <div class="mb-3">
                            <label for="AdminComment" class="form-label">Admin Comment *</label>
                            <textarea name="AdminComment" class="form-control" required>@article.AdminComment</textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-danger">Decline</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/assets/js/ManageArticle.js"></script>
}
