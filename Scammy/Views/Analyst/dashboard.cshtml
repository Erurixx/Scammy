@{
    ViewBag.Title = "Analyst Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles {
    <link rel="stylesheet" href="~/assets/css/dashboard.css" />
}

<section id="analyst-dashboard" >
    <div class="az-content az-content-dashboard" style="margin-top:6rem;">
        <div class="container">
            <div class="az-content-body">
                <div class="az-dashboard-one-title">
                    <div>
                        <h2 class="az-dashboard-title">Hi, welcome back!</h2>
                        <p class="az-dashboard-text">Manage scam awareness content, review reports, and track trends.</p>
                    </div>
                    
                </div>

                <div class="az-dashboard-nav">
                    <nav class="nav">
                        <a class="nav-link active" data-toggle="tab" href="#">Overview</a>

                        @* <a class="nav-link" href="@Url.Action("ManageArticle", "Admin")">Manage Articles</a> *@
@* <!--                         <a class="nav-link" href="@Url.Action("viewPublishedArticles", "Analyst")">View Published Articles</a> --> *@

<!--                         @* <a class="nav-link" data-toggle="tab" href="#">Manage Articles</a> *@ -->
                        <a class="nav-link" href="@Url.Action("viewPublishedArticles", "Analyst")">View/Manage Articles</a>

                        <a class="nav-link" href="@Url.Action("createArticle", "Analyst")">Create New Article +</a>

                        
                    </nav>
                    <nav class="nav">
                    </nav>
                </div>

                <div class="row row-sm mg-b-20">
                    <div class="col-lg-7 ht-lg-100p">
                        <div class="card card-dashboard-one">
                            <div class="card-header">
                                <div>
                                    <h6 class="card-title">Total Reported Scams</h6>
                                    @* <p class="card-text">Summary of reported scams for the selected date range.</p> *@
                                </div>
                                @* <div class="btn-group">
                                    <button class="btn active">Day</button>
                                    <button class="btn">Week</button>
                                    <button class="btn">Month</button>
                                </div> *@
                            </div><!-- card-header -->
                            <div class="card-body">
                                <div class="card-body-top">
                                    <div>
                                        <label class="mg-b-0">New Articles Posted</label>
                                        <h2>@ViewBag.TotalArticles</h2>
                                    </div>
                                    <div>
                                        <label class="mg-b-0">Approved Articles</label>
                                        <h2>@ViewBag.ApprovalRate%</h2>
                                    </div>
                                    <div>
                                        <label class="mg-b-0">Pending Articles</label>
                                        <h2>@ViewBag.PendingArticles</h2>
                                    </div>
                                </div>
                                <div class="flot-chart-wrapper">
                                    <div id="flotChart" class="flot-chart"></div>
                                </div><!-- flot-chart-wrapper -->
                            </div><!-- card-body -->
                        </div><!-- card -->
                    </div><!-- col -->

                    <div class="col-lg-5 mg-t-20 mg-lg-t-0">
                        <div class="row row-sm">
                            <div class="col-sm-6">
                                <div class="card card-dashboard-two">
                                    <div class="card-header">
                                        <h6>@ViewBag.ApprovalRate% <i class="icon ion-md-trending-up tx-success"></i></h6>
                                        <p>Article Approval Rate</p>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-wrapper">
                                            <div id="flotChart1" class="flot-chart"></div>
                                        </div><!-- chart-wrapper -->
                                    </div><!-- card-body -->
                                </div><!-- card -->
                            </div><!-- col -->
                            <div class="col-sm-6 mg-t-20 mg-sm-t-0">
                                <div class="card card-dashboard-two">
                                    <div class="card-header">
                                        <h6>@ViewBag.TotalArticles <i class="icon ion-md-trending-up tx-success"></i> <small>@((ViewBag.TotalArticles > 0 ? "+0.86%" : "0%"))</small></h6>
                                        <p>Articles Created</p>
                                    </div><!-- card-header -->
                                    <div class="card-body">
                                        <div class="chart-wrapper">
                                            <div id="flotChart2" class="flot-chart"></div>
                                        </div><!-- chart-wrapper -->
                                    </div><!-- card-body -->
                                </div><!-- card -->
                            </div><!-- col -->
                            <div class="col-sm-12 mg-t-20">
                                <div class="card card-dashboard-three">
                                    <div class="card-header">
                                        <p>Total Articles Published</p>
                                        <h6>@ViewBag.ApprovedArticles <small class="tx-success"><i class="icon ion-md-arrow-up"></i></small></h6>
                                        <small>The total number of scam awareness articles published.</small>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart"><canvas id="chartBar5"></canvas></div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- row -->
                    </div><!--col -->
                </div><!-- row -->

                
        </div>
    </div><!-- az-content -->
    </div>
    
</section>

@section Scripts {

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery (required for Flot and Peity) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Flot Charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.time.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.resize.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <!-- Peity for small charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peity/3.3.0/jquery.peity.min.js"></script>

    <!-- Your custom dashboard JavaScript -->
    <script src="~/assets/js/charts.js"></script>
    <script src="~/assets/js/analyst.js"></script>

    <script>
        // Convert server-side data to JS
        var chartData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.ChartData ?? new List<object>()));
        var totalArticlesData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.TotalArticlesChartData ?? new List<object>()));

        // Prepare Flot data - use real data if available, otherwise use sample data
        var flotData = [];
        var flotData2 = [];
        var totalArticlesFlotData = [];

        if (chartData && chartData.length > 0) {
            flotData = chartData.map((d, i) => [i * 3, d.Count]);
            // Create a second dataset for comparison (e.g., previous period)
            flotData2 = chartData.map((d, i) => [i * 3, Math.max(0, d.Count - Math.floor(Math.random() * 5))]);
        } else {
            // Fallback to sample data if no real data
            flotData = [[0, 20], [10, 25], [20, 35], [30, 30], [40, 45], [50, 40]];
            flotData2 = [[0, 15], [10, 20], [20, 25], [30, 35], [40, 30], [50, 35]];
        }

        // Prepare data for total articles chart
        if (totalArticlesData && totalArticlesData.length > 0) {
            totalArticlesFlotData = totalArticlesData.map((d, i) => [i * 5, d.Count]);
        } else {
            totalArticlesFlotData = [[0, 5], [5, 8], [10, 12], [15, 10], [20, 15], [25, 18], [30, 20], [35, 22], [40, 25], [45, 23], [50, 28]];
        }

        // Pass data to charts.js
        window.realChartData = {
            mainChart: flotData,
            secondaryChart: flotData2,
            totalArticlesChart: totalArticlesFlotData, // New chart data
            approvalRate: @ViewBag.ApprovalRate,
            totalArticles: @ViewBag.TotalArticles,
            approvedArticles: @ViewBag.ApprovedArticles
        };
    </script>
}
