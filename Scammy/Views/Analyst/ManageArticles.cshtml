@{
    ViewBag.Title = "Analyst Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/analyst.css" />

<section class="analyst-dashboard">
    <div class="container">
        <div class="dashboard-header">
            <div class="header-content">
                <h1>Analyst Dashboard</h1>
                <p>Manage awareness articles to help job seekers stay protected from scams</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" style="padding:9px;"onclick="openArticleModal()">
                    <i class="fas fa-plus"></i> New Article
                </button>
                <button class="btn btn-outline" onclick="exportArticles()">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon published">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3>24</h3>
                    <p>Published Articles</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon draft">
                    <i class="fas fa-edit"></i>
                </div>
                <div class="stat-info">
                    <h3>7</h3>
                    <p>Draft Articles</p>
                </div>
            </div>
            @* <div class="stat-card">
                <div class="stat-icon views">
                    <i class="fas fa-eye"></i>
                </div>
                <div class="stat-info">
                    <h3>12,543</h3>
                    <p>Total Views</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon engagement">
                    <i class="fas fa-thumbs-up"></i>
                </div>
                <div class="stat-info">
                    <h3>89%</h3>
                    <p>Engagement Rate</p>
                </div>
            </div> *@
        </div>

        <!-- Filter and Search -->
        <div class="content-controls">
            <div class="search-filter">
                <div class="search-box-large">
                    <i class="fas fa-search"></i>
                    <input type="text" id="articleSearch" placeholder="Search articles..." onkeyup="filterArticles()">
                </div>
                <select id="statusFilter" onchange="filterArticles()" class="filter-select">
                    <option value="all">All Status</option>
                    <option value="published">Published</option>
                    <option value="draft">Draft</option>
                    <option value="archived">Archived</option>
                </select>
                <select id="categoryFilter" onchange="filterArticles()" class="filter-select">
                    <option value="all">All Categories</option>
                    <option value="prevention">Prevention</option>
                    <option value="identification">Identification</option>
                    <option value="reporting">Reporting</option>
                    <option value="recovery">Recovery</option>
                </select>
            </div>
        </div>

        <!-- Articles Table -->
        <div class="articles-table-container">
            <div class="table-header">
                <h3><i class="fas fa-newspaper"></i> Awareness Articles</h3>
                @* <div class="table-actions">
                    <button class="btn btn-outline btn-small" onclick="toggleView('grid')">
                        <i class="fas fa-th"></i> Grid
                    </button>
                    <button class="btn btn-outline btn-small" onclick="toggleView('list')">
                        <i class="fas fa-list"></i> List
                    </button>
                </div> *@
            </div>

            <!-- List View (Default) -->
            <div id="listView" class="articles-list">
                <div class="article-item" data-status="published" data-category="prevention">
                    <div class="article-thumbnail">
                        <img src="https://via.placeholder.com/80x80/584a5a/f0f1f3?text=Article" alt="Article thumbnail">
                    </div>
                    <div class="article-details">
                        <div class="article-header">
                            <h4>How to Identify Fake Job Postings</h4>
                            <div class="article-badges">
                                <span class="badge status-published">Published</span>
                                <span class="badge category-prevention">Prevention</span>
                            </div>
                        </div>
                        <p class="article-excerpt">Learn the warning signs of fraudulent job postings and protect yourself from employment scams...</p>
                        <div class="article-meta">
                            <span><i class="fas fa-calendar"></i> Dec 15, 2024</span>
                            <span><i class="fas fa-eye"></i> 1,234 views</span>
                            <span><i class="fas fa-thumbs-up"></i> 45 likes</span>
                        </div>
                    </div>
                    <div class="article-actions">
                        <button class="action-btn view" onclick="viewArticle(1)" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" onclick="editArticle(1)" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteArticle(1)" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="action-btn more" onclick="toggleMoreActions(1)" title="More">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>

                <div class="article-item" data-status="draft" data-category="identification">
                    <div class="article-thumbnail">
                        <img src="https://via.placeholder.com/80x80/584a5a/f0f1f3?text=Draft" alt="Article thumbnail">
                    </div>
                    <div class="article-details">
                        <div class="article-header">
                            <h4>Red Flags in Recruitment Emails</h4>
                            <div class="article-badges">
                                <span class="badge status-draft">Draft</span>
                                <span class="badge category-identification">Identification</span>
                            </div>
                        </div>
                        <p class="article-excerpt">Comprehensive guide to spotting suspicious recruitment communications and protecting your personal information...</p>
                        <div class="article-meta">
                            <span><i class="fas fa-calendar"></i> Dec 18, 2024</span>
                            <span><i class="fas fa-edit"></i> Last edited</span>
                        </div>
                    </div>
                    <div class="article-actions">
                        <button class="action-btn view" onclick="viewArticle(2)" title="Preview">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" onclick="editArticle(2)" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteArticle(2)" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="action-btn more" onclick="toggleMoreActions(2)" title="More">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>

                
            </div>

            <!-- Grid View (Hidden by default) -->
            <div id="gridView" class="articles-grid" style="display: none;">
                <div class="article-card" data-status="published" data-category="prevention">
                    <div class="card-image">
                        <img src="https://via.placeholder.com/300x150/584a5a/f0f1f3?text=Article" alt="Article thumbnail">
                        <div class="card-badges">
                            <span class="badge status-published">Published</span>
                        </div>
                    </div>
                    <div class="card-content">
                        <span class="badge category-prevention">Prevention</span>
                        <h4>How to Identify Fake Job Postings</h4>
                        <p>Learn the warning signs of fraudulent job postings...</p>
                        <div class="card-meta">
                            <span><i class="fas fa-eye"></i> 1,234</span>
                            <span><i class="fas fa-thumbs-up"></i> 45</span>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-small" onclick="editArticle(1)">Edit</button>
                        <button class="btn btn-primary btn-small" onclick="viewArticle(1)">View</button>
                    </div>
                </div>
                <!-- More grid items would be generated dynamically -->
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination-info">
                Showing 1-10 of 31 articles
            </div>
            <div class="pagination">
                <button class="page-btn" disabled><i class="fas fa-chevron-left"></i></button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">4</button>
                <button class="page-btn"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>
</section>

<!-- Article Modal -->
<div id="articleModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Create New Article</h3>
            <button class="modal-close" onclick="closeArticleModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="articleForm" class="modal-body" method="post">
            <div class="form-row">
                <div class="form-group">
                    <label for="articleTitle">Article Title *</label>
                    <input type="text" id="articleTitle" class="form-control" placeholder="Enter article title" required>
                </div>
                <div class="form-group">
                    <label for="articleCategory">Category *</label>
                    <select id="articleCategory" class="form-control" required>
                        <option value="">Select category</option>
                        <option value="prevention">Prevention</option>
                        <option value="identification">Identification</option>
                        <option value="reporting">Reporting</option>
                        <option value="recovery">Recovery</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="articleExcerpt">Article Excerpt</label>
                <textarea id="articleExcerpt" class="form-control" rows="2" placeholder="Brief description for article preview"></textarea>
            </div>

            <div class="form-group">
                <label for="articleContent">Article Content *</label>
                <div class="editor-toolbar">
                    <button type="button" class="editor-btn" onclick="formatText('bold')"><i class="fas fa-bold"></i></button>
                    <button type="button" class="editor-btn" onclick="formatText('italic')"><i class="fas fa-italic"></i></button>
                    <button type="button" class="editor-btn" onclick="formatText('underline')"><i class="fas fa-underline"></i></button>
                    <button type="button" class="editor-btn" onclick="insertList()"><i class="fas fa-list-ul"></i></button>
                    <button type="button" class="editor-btn" onclick="insertLink()"><i class="fas fa-link"></i></button>
                </div>
                <textarea id="articleContent" class="form-control editor-content" rows="10" placeholder="Write your article content here..." required></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="articleTags">Tags (comma-separated)</label>
                    <input type="text" id="articleTags" class="form-control" placeholder="scam, prevention, safety">
                </div>
                <div class="form-group">
                    <label for="articleStatus">Status</label>
                    <select id="articleStatus" class="form-control">
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="articleImage">Featured Image</label>
                <div class="image-upload">
                    <input type="file" id="articleImage" accept="image/*" style="display: none;" onchange="previewImage(this)">
                    <div class="upload-area" onclick="document.getElementById('articleImage').click()">
                        <div class="upload-content">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload image or drag and drop</p>
                            <small>PNG, JPG, GIF up to 5MB</small>
                        </div>
                        <img id="imagePreview" style="display: none;" alt="Preview">
                    </div>
                </div>
            </div>
        </form>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline" onclick="closeArticleModal()">Cancel</button>
            <button type="button" class="btn btn-outline" onclick="saveArticleDraft()">Save Draft</button>
            <button type="submit" form="articleForm" class="btn btn-primary">Publish Article</button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <button class="modal-close" onclick="closeDeleteModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="delete-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Are you sure you want to delete this article? This action cannot be undone.</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline" onclick="closeDeleteModal()">Cancel</button>
            <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete Article</button>
        </div>
    </div>
</div>

<script src="~/js/ManageArticles.js"></script>


@* <script>
    // Global variables
    let currentView = 'list';
    let currentArticleId = null;
    let deleteArticleId = null;

    // Modal functions
    function openArticleModal(articleId = null) {
        currentArticleId = articleId;
        const modal = document.getElementById('articleModal');
        const title = document.getElementById('modalTitle');

        if (articleId) {
            title.textContent = 'Edit Article';
            // Load article data here
            loadArticleData(articleId);
        } else {
            title.textContent = 'Create New Article';
            document.getElementById('articleForm').reset();
        }

        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeArticleModal() {
        document.getElementById('articleModal').style.display = 'none';
        document.body.style.overflow = 'auto';
        currentArticleId = null;
    }

    function deleteArticle(articleId) {
        deleteArticleId = articleId;
        document.getElementById('deleteModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
        document.body.style.overflow = 'auto';
        deleteArticleId = null;
    }

    function confirmDelete() {
        // Implement delete logic here
        console.log('Deleting article:', deleteArticleId);
        closeDeleteModal();
    }

    // View functions
    function toggleView(view) {
        currentView = view;
        const listView = document.getElementById('listView');
        const gridView = document.getElementById('gridView');

        if (view === 'grid') {
            listView.style.display = 'none';
            gridView.style.display = 'grid';
        } else {
            listView.style.display = 'block';
            gridView.style.display = 'none';
        }
    }

    function filterArticles() {
        const searchTerm = document.getElementById('articleSearch').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;
        const categoryFilter = document.getElementById('categoryFilter').value;

        const articles = document.querySelectorAll('.article-item, .article-card');

        articles.forEach(article => {
            const title = article.querySelector('h4').textContent.toLowerCase();
            const status = article.dataset.status;
            const category = article.dataset.category;

            const matchesSearch = title.includes(searchTerm);
            const matchesStatus = statusFilter === 'all' || status === statusFilter;
            const matchesCategory = categoryFilter === 'all' || category === categoryFilter;

            if (matchesSearch && matchesStatus && matchesCategory) {
                article.style.display = '';
            } else {
                article.style.display = 'none';
            }
        });
    }

    // Editor functions
    function formatText(command) {
        document.execCommand(command, false, null);
    }

    function insertList() {
        document.execCommand('insertUnorderedList', false, null);
    }

    function insertLink() {
        const url = prompt('Enter URL:');
        if (url) {
            document.execCommand('createLink', false, url);
        }
    }

    function previewImage(input) {
        const preview = document.getElementById('imagePreview');
        const uploadContent = input.parentNode.querySelector('.upload-content');

        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                uploadContent.style.display = 'none';
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // Article management functions
    function viewArticle(articleId) {
        console.log('Viewing article:', articleId);
        // Implement view logic
    }

    function editArticle(articleId) {
        openArticleModal(articleId);
    }

    function loadArticleData(articleId) {
        // Implement article loading logic
        console.log('Loading article data for:', articleId);
    }

    function saveArticleDraft() {
        console.log('Saving article as draft');
        // Implement save draft logic
    }

    function exportArticles() {
        console.log('Exporting articles');
        // Implement export logic
    }

    function toggleMoreActions(articleId) {
        console.log('Toggle more actions for:', articleId);
        // Implement more actions dropdown
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
        const articleModal = document.getElementById('articleModal');
        const deleteModal = document.getElementById('deleteModal');

        if (event.target === articleModal) {
            closeArticleModal();
        }
        if (event.target === deleteModal) {
            closeDeleteModal();
        }
    }

    // Form submission
    document.getElementById('articleForm').onsubmit = function(e) {
        e.preventDefault();
        console.log('Publishing article');
        // Implement form submission logic
        closeArticleModal();
    };
</script> *@